# 托盘功能实现计划

## 功能描述
实现应用在后台运行时通过系统托盘继续工作的功能，包括：
- 应用最小化到系统托盘而不是关闭
- 通过托盘图标和菜单控制应用
- 保持快捷键功能在后台可用

## 实现步骤

### 1. 基础架构
- [x] 创建托盘图标资源
  - [x] 准备 tray-icon.png 文件
  - [x] 放置在 src/assets 目录下

### 2. 主进程修改
- [x] 修改 src/main/index.ts
  - [x] 添加 Tray 相关导入
  - [x] 实现 createTray 函数
  - [x] 修改窗口关闭行为
  - [x] 添加托盘菜单事件处理
  - [x] 完善退出流程

### 3. 类型定义
- [x] 修改 src/renderer/types/electron.d.ts
  - [x] 添加新的 IPC 事件类型定义
  - [x] 添加托盘相关方法类型

### 4. 预加载脚本
- [x] 修改 src/preload.ts
  - [x] 添加新的事件监听器
  - [x] 实现托盘相关方法

### 5. 渲染进程
- [x] 修改 src/renderer/App.tsx
  - [x] 添加托盘菜单事件处理
  - [x] 完善状态管理

## 可能的影响

### 用户体验
- 应用行为改变：关闭按钮变为最小化到托盘
- 新增托盘图标和菜单
- 快捷键在后台可用

### 功能影响
- 录音状态管理需要更完善
- 应用退出流程需要更严谨
- 需要处理托盘图标的清理

### 性能影响
- 应用在后台时仍然占用内存
- 需要管理额外的系统资源

## 测试计划

### 1. 测试窗口最小化到托盘
- [ ] 基本功能测试
  - [ ] 点击窗口关闭按钮，确认窗口隐藏而不是关闭
  - [ ] 检查系统托盘区域是否显示应用图标
  - [ ] 点击托盘图标，确认窗口重新显示
  - [ ] 右键托盘图标，确认菜单正确显示

- [ ] 状态保持测试
  - [ ] 最小化前开始录音，确认录音状态保持
  - [ ] 最小化前停止录音，确认状态正确
  - [ ] 最小化前取消录音，确认状态正确

- [ ] 多窗口测试
  - [ ] 打开多个窗口，确认所有窗口都能正确最小化
  - [ ] 确认托盘图标行为一致

- [ ] 异常情况测试
  - [ ] 快速多次点击关闭按钮
  - [ ] 在录音过程中最小化
  - [ ] 在任务列表操作过程中最小化

### 2. 测试托盘菜单功能
- [ ] 测试开始录音
- [ ] 测试停止录音
- [ ] 测试取消录音
- [ ] 测试应用退出

### 3. 测试后台快捷键
- [ ] 测试开始录音快捷键
- [ ] 测试停止录音快捷键
- [ ] 测试取消录音快捷键

### 4. 测试应用退出流程
- [ ] 测试正常退出
- [ ] 测试强制退出
- [ ] 测试异常退出

### 5. 测试录音状态同步
- [ ] 测试状态更新
- [ ] 测试状态恢复
- [ ] 测试状态清理

### 6. 测试内存占用
- [ ] 测试最小化时内存占用
- [ ] 测试长时间运行内存占用
- [ ] 测试多窗口内存占用

## 注意事项
1. 确保托盘图标资源存在
2. 处理不同平台的托盘行为差异
3. 完善错误处理
4. 确保资源正确清理

## 测试环境要求
1. macOS 系统
2. 开发环境（Vite dev server）
3. 生产环境（打包后的应用）

## 测试工具
1. 开发者工具（DevTools）
2. 活动监视器（Activity Monitor）
3. 系统日志（Console.app） 